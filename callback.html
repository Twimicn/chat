<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Loading</title>
</head>
<body>
<script>
    (function () {
        function getQueryString(name) {
            let reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
            let r = window.location.search.substr(1).match(reg);
            if (r != null) {
                return unescape(r[2]);
            }
            return null;
        }

        const URL = 'https://twimi.cn/api/';
        const HEADER = {'content-type': 'application/x-www-form-urlencoded'};
        const CLIENT_ID = '';
        const CLIENT_SECRET = '';

        fetch(`${URL}oauth/token`, {
            method: 'post',
            headers: HEADER,
            body: `client_id=${CLIENT_ID}&client_secret=${CLIENT_SECRET}&code=` + getQueryString("code")
        }).then(r => r.json()).then(r => {
            localStorage.setItem('expire', r.expire);
            let token = r.token;
            fetch(`${URL}user/info`, {
                method: 'post',
                headers: HEADER,
                body: `client_id=${CLIENT_ID}&token=${token}`
            }).then(r2 => r2.json()).then(r2 => {
                console.log(r2);
            })
        });
    })();
</script>
</body>
</html>
